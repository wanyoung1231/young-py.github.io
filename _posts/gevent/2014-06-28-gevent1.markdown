---
layout: post
title:  "gevent 学习笔记 —— greenlet"
date:   2014-06-28 16:48:45
categories: gevent
author: young
---

![](http://young-py.github.io/imgs/yyzt2.jpg)

从gevent官方描述中又提到：that uses greenlet to provide a high-level synchronous API.

翻译：使用greenlet来提供高级同步API。这次学习的主要内容——**greenlet**。

-----

### **Greenlet**

greenlet是python中实现我们所谓的"Coroutine(协程)"的一个基础库。前面我们知道了协程是个什么样的东西，但是我们还不知道协程在底层是怎样实现的。在协程篇我们知道，子例程是协程的特例。我们花了比较长的篇幅讲述协程是怎么从子例程中演变过来的。我们知道协程有个特别的地方，就是它能够和进程、线程一样保存上下文，那这个上下文是怎样保存的呢？

-----

### **源码分析**

{% highlight c %}

typedef struct _greenlet {
    PyObject_HEAD
    char* stack_start;
    char* stack_stop;
    char* stack_copy;
    intptr_t stack_saved;
    struct _greenlet* stack_prev;
    struct _greenlet* parent;
    PyObject* run_info;
    struct _frame* top_frame;
    int recursion_depth;
    PyObject* weakreflist;
    PyObject* exc_type;
    PyObject* exc_value;
    PyObject* exc_traceback;
    PyObject* dict;
} PyGreenlet;

{% endhighlight %}







